const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-eZel76Zb.js","assets/vue-vendor-B1el7s55.js","assets/math-vendor-C4rbpj_m.js","assets/markdown-vendor-BDlm1NQN.js","assets/index-DCljqfLO.css"])))=>i.map(i=>d[i]);
import{aB as ee}from"./math-vendor-C4rbpj_m.js";import{u as G,r as C,p as te,l as Q,d as ae,c as H,q as re,o as oe,s as J,a as _,b as r,t as p,e as a,i as M,F as R,g as B,x as se,f as g,k as y,w,v as E,y as le,n as ie,h as S}from"./vue-vendor-B1el7s55.js";import{c as ne,g as ce}from"./index-eZel76Zb.js";import{u as de}from"./useCategories-CHzFovT5.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./markdown-vendor-BDlm1NQN.js";const fe="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let j=(o=21)=>{let l="",v=crypto.getRandomValues(new Uint8Array(o|=0));for(;o--;)l+=fe[v[o]&63];return l};function z(o){const l=[];return o.title&&l.push(`title: ${K(o.title)}`),o.description&&l.push(`description: ${K(o.description)}`),o.categoryKey&&l.push(`categoryKey: ${K(o.categoryKey)}`),o.tag&&l.push(`tag: ${K(o.tag)}`),o.badge&&l.push(`badge: ${K(o.badge)}`),o.date&&l.push(`date: ${K(o.date)}`),o.platform&&l.push(`platform: ${K(o.platform)}`),o.cover&&l.push(`cover: ${K(o.cover)}`),(l.length>0?`---
${l.join(`
`)}
---

`:"")+(o.content||"").trim()}function K(o){return o.includes(":")||o.includes("#")||o.includes("|")||o.includes("&")||o.includes("*")||o.includes("!")||o.includes("%")||o.includes("@")||o.includes("`")||o.startsWith(" ")||o.endsWith(" ")||o.includes(`
`)?`"${o.replace(/"/g,'\\"')}"`:o}function Y(o){const l=o.date||new Date().toISOString().split("T")[0],k=(o.title||"untitled").toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim();return`${l}-${k}`}const N=new Map;function L(o,l){try{const v=localStorage.getItem("article-file-handles")||"{}",k=JSON.parse(v);k[o]=l,localStorage.setItem("article-file-handles",JSON.stringify(k))}catch(v){console.error("Failed to save file handle:",v)}}function me(o){try{const l=localStorage.getItem("article-file-handles");if(l)return JSON.parse(l)[o]||null}catch(l){console.error("Failed to get file handle name:",l)}return null}const pe=()=>{const o=Q(),{messages:l,locale:v}=G(),k=C(!1),D=C(!1),W=(()=>{const m=l.value[v.value]?.categories||{},P=Object.keys(m).filter(u=>u!=="all");return P.length>0?P[0]:"c/c++"})(),e=te({title:"",description:"",content:"",categoryKey:W,tag:"",badge:"",date:new Date().toISOString().split("T")[0],platform:"Wechat",cover:"linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)"}),i=()=>{e.title="",e.description="",e.content="",e.categoryKey=W,e.tag="",e.badge="",e.date=new Date().toISOString().split("T")[0],e.platform="Wechat",e.cover="linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)"},I=c=>ne.some(m=>m.id===c),F=c=>{e.id=c.id,e.title=c.title,e.description=c.description,e.content=c.content,e.categoryKey=c.categoryKey,e.tag=c.tag,e.badge=c.badge,e.date=c.date,e.platform=c.platform,e.cover=c.cover},s=()=>{const c=[];return e.title?.trim()||c.push({field:"title",message:"title"}),e.description?.trim()||c.push({field:"description",message:"description"}),e.content?.trim()||c.push({field:"content",message:"content"}),e.categoryKey||c.push({field:"category",message:"category"}),e.tag?.trim()||c.push({field:"tag",message:"tag"}),e.date||c.push({field:"date",message:"date"}),e.platform?.trim()||c.push({field:"platform",message:"platform"}),e.cover?.trim()||c.push({field:"cover",message:"cover"}),c},V=async()=>s().length>0?null:{id:e.id||j(),title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||"dit",tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],platform:e.platform||"Wechat",cover:e.cover||""};return{form:e,isSubmitting:k,isSavingFile:D,resetForm:i,loadArticle:F,validateForm:s,handleSubmit:V,handleSubmitAndRedirect:async()=>{const c=await V();c&&o.push({name:"articleDetail",params:{id:c.id}})},handlePublish:async()=>{if(s().length>0)return!1;if(!("showDirectoryPicker"in window))return alert("您的浏览器不支持文件系统访问 API，请使用 Chrome、Edge 或 Opera 浏览器"),!1;D.value=!0;try{const m={id:e.id||j(),title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||W,tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],platform:e.platform||"Wechat",cover:e.cover||""},P=z(m),u=Y(m)+".md",h=await(await window.showDirectoryPicker()).getFileHandle(u,{create:!0}),A=await h.createWritable();return await A.write(P),await A.close(),m.id&&(N.set(m.id,h),L(m.id,u)),!0}catch(m){return m.name!=="AbortError"&&(console.error("Failed to save file:",m),alert("保存文件失败："+(m.message||"未知错误"))),!1}finally{D.value=!1}},handleUpdate:async()=>{if(s().length>0||!e.id)return!1;if(!("showSaveFilePicker"in window))return alert("您的浏览器不支持文件系统访问 API，请使用 Chrome、Edge 或 Opera 浏览器"),!1;D.value=!0;try{const m={id:e.id,title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||W,tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],platform:e.platform||"Wechat",cover:e.cover||""},P=z(m),u=Y(m)+".md";let f=N.get(e.id);if(!f){const h=me(e.id);try{f=(await window.showOpenFilePicker({types:[{description:"Markdown files",accept:{"text/markdown":[".md"]}}],multiple:!1}))[0],N.set(e.id,f),h?L(e.id,h):L(e.id,u)}catch(A){if(A.name!=="AbortError")throw A;return!1}}if(f){const h=await f.createWritable();await h.write(P),await h.close()}else throw new Error("无法获取文件句柄");return!0}catch(m){return m.name!=="AbortError"&&(console.error("Failed to update file:",m),alert("更新文件失败："+(m.message||"未知错误"))),!1}finally{D.value=!1}},isArticleFromContent:I}},ge={class:"layout edit-layout"},ve={class:"hero"},he={class:"edit-content"},ye={key:0,class:"validation-errors"},be={class:"error-header"},_e={class:"error-title"},we={class:"error-list"},Se={class:"form-section"},ke=["placeholder"],Ie={class:"form-section"},Fe=["placeholder"],Pe={class:"form-row"},Ae={class:"form-section"},Ee=["value"],Ke={class:"form-section"},De=["placeholder"],We={class:"form-row"},Ce={class:"form-section"},Ve={class:"form-section"},xe=["placeholder"],Ue={class:"form-row"},$e={class:"form-section"},Oe={class:"form-label"},Te=["placeholder"],He={class:"form-section"},Me={class:"cover-input-group"},Re=["placeholder"],Be={class:"cover-actions"},Ne={key:0,class:"cover-preview"},Le=["src"],qe={class:"form-section"},Je={class:"form-label"},je={class:"cover-presets"},ze=["onClick"],Ye={class:"form-section"},Ge=["placeholder"],Qe={class:"form-hint"},Xe={class:"form-actions"},Ze=["disabled"],et=ae({__name:"ArticleEditPage",setup(o){const l=C(null),v=C(),k=n=>{const t=n.target.files?.[0];if(t){if(!t.type.startsWith("image/")){alert(i("article.coverImageError"));return}if(t.size>5*1024*1024){alert(i("article.coverImageSizeError"));return}const b=new FileReader;b.onload=U=>{const T=U.target?.result;T&&(l.value=T,s.cover=T)},b.onerror=()=>{alert(i("article.coverImageError"))},b.readAsDataURL(t)}},D=()=>{l.value=null,v.value&&(v.value.value=""),s.cover=""},x=H(()=>{if(l.value)return l.value;if(s.cover){const n=s.cover.trim();if(n.startsWith("http://")||n.startsWith("https://")||n.startsWith("data:image/"))return n}return null}),W=re(),e=Q(),{t:i}=G(),I=H(()=>!!W.params.id),F=H(()=>{const n=W.params.id;return n||null}),{form:s,isSubmitting:V,isSavingFile:$,loadArticle:q,validateForm:O,resetForm:c,handlePublish:m,handleUpdate:P}=pe(),u=C([]),f=C(!1),{categories:h}=de(!1),A=["linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)","linear-gradient(135deg, #0d121f 0%, #132642 50%, #243c5a 100%)","linear-gradient(135deg, #101820 0%, #1f1f2f 50%, #2c2c3b 100%)","linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)","linear-gradient(135deg, #2d1b69 0%, #11998e 100%)","linear-gradient(135deg, #667eea 0%, #764ba2 100%)"];oe(()=>{if(I.value&&F.value){const n=ce(F.value);n?(q(n),n.cover&&(n.cover.startsWith("http://")||n.cover.startsWith("https://")||n.cover.startsWith("data:image/"))&&(l.value=n.cover)):e.push({name:"articles"})}else c()}),J(()=>[s.title,s.description,s.content,s.categoryKey,s.tag,s.date,s.platform,s.cover],()=>{if(f.value&&u.value.length>0){const n=O();u.value=n,n.length===0&&(f.value=!1)}}),J(()=>s.cover,n=>{n&&(n.startsWith("http://")||n.startsWith("https://")||n.startsWith("data:image/"))?(!l.value||l.value!==n)&&(l.value=n):n||(l.value=null)});const X=()=>{I.value&&F.value?e.push({name:"articleDetail",params:{id:F.value}}):e.push({name:"articles"})},Z=async()=>{const n=O();if(n.length>0){u.value=n,f.value=!0,setTimeout(()=>{const d=document.querySelector(".form-error");d&&d.scrollIntoView({behavior:"smooth",block:"center"})},100);return}if(u.value=[],f.value=!1,I.value&&F.value){if(await P()){const{reloadArticles:t}=await ee(async()=>{const{reloadArticles:b}=await import("./index-eZel76Zb.js").then(U=>U.i);return{reloadArticles:b}},__vite__mapDeps([0,1,2,3,4]));await t(),e.push({name:"articleDetail",params:{id:F.value}})}}else await m()&&e.push({name:"articles"})};return(n,d)=>(S(),_("main",ge,[r("section",ve,[r("h1",null,p(I.value?a(i)("article.editTitle"):a(i)("article.createTitle")),1),r("p",null,p(I.value?a(i)("article.editDesc"):a(i)("article.createDesc")),1)]),r("section",he,[f.value&&u.value.length>0?(S(),_("div",ye,[r("div",be,[d[11]||(d[11]=r("span",{class:"error-icon"},"⚠️",-1)),r("span",_e,p(a(i)("article.validationError")),1)]),r("ul",we,[(S(!0),_(R,null,B(u.value,(t,b)=>(S(),_("li",{key:b,class:"error-item"},p(a(i)(`article.${t.message}Required`)),1))),128))])])):M("",!0),r("form",{class:"article-form",onSubmit:se(Z,["prevent"])},[r("div",Se,[r("label",{class:g(["form-label",{"has-error":f.value&&u.value.some(t=>t.field==="title")}])},[y(p(a(i)("article.title"))+" ",1),w(r("input",{"onUpdate:modelValue":d[0]||(d[0]=t=>a(s).title=t),type:"text",placeholder:a(i)("article.titlePlaceholder"),class:g({"form-error":f.value&&u.value.some(t=>t.field==="title")})},null,10,ke),[[E,a(s).title]])],2)]),r("div",Ie,[r("label",{class:g(["form-label",{"has-error":f.value&&u.value.some(t=>t.field==="description")}])},[y(p(a(i)("article.description"))+" ",1),w(r("textarea",{"onUpdate:modelValue":d[1]||(d[1]=t=>a(s).description=t),rows:"3",placeholder:a(i)("article.descriptionPlaceholder"),class:g({"form-error":f.value&&u.value.some(t=>t.field==="description")})},null,10,Fe),[[E,a(s).description]])],2)]),r("div",Pe,[r("div",Ae,[r("label",{class:g(["form-label",{"has-error":f.value&&u.value.some(t=>t.field==="category")}])},[y(p(a(i)("article.category"))+" ",1),w(r("select",{"onUpdate:modelValue":d[2]||(d[2]=t=>a(s).categoryKey=t),class:g({"form-error":f.value&&u.value.some(t=>t.field==="category")})},[(S(!0),_(R,null,B(a(h),t=>(S(),_("option",{key:t.key,value:t.key},p(t.label),9,Ee))),128))],2),[[le,a(s).categoryKey]])],2)]),r("div",Ke,[r("label",{class:g(["form-label",{"has-error":f.value&&u.value.some(t=>t.field==="tag")}])},[y(p(a(i)("article.tag"))+" ",1),w(r("input",{"onUpdate:modelValue":d[3]||(d[3]=t=>a(s).tag=t),type:"text",placeholder:a(i)("article.tagPlaceholder"),class:g({"form-error":f.value&&u.value.some(t=>t.field==="tag")})},null,10,De),[[E,a(s).tag]])],2)])]),r("div",We,[r("div",Ce,[r("label",{class:g(["form-label",{"has-error":f.value&&u.value.some(t=>t.field==="date")}])},[y(p(a(i)("article.date"))+" ",1),w(r("input",{"onUpdate:modelValue":d[4]||(d[4]=t=>a(s).date=t),type:"date",class:g({"form-error":f.value&&u.value.some(t=>t.field==="date")})},null,2),[[E,a(s).date]])],2)]),r("div",Ve,[r("label",{class:g(["form-label",{"has-error":f.value&&u.value.some(t=>t.field==="platform")}])},[y(p(a(i)("article.platform"))+" ",1),w(r("input",{"onUpdate:modelValue":d[5]||(d[5]=t=>a(s).platform=t),type:"text",placeholder:a(i)("article.platformPlaceholder"),class:g({"form-error":f.value&&u.value.some(t=>t.field==="platform")})},null,10,xe),[[E,a(s).platform]])],2)])]),r("div",Ue,[r("div",$e,[r("label",Oe,[y(p(a(i)("article.badge"))+" ",1),w(r("input",{"onUpdate:modelValue":d[6]||(d[6]=t=>a(s).badge=t),type:"text",placeholder:a(i)("article.badgePlaceholder")},null,8,Te),[[E,a(s).badge]])])]),r("div",He,[r("label",{class:g(["form-label",{"has-error":f.value&&u.value.some(t=>t.field==="cover")}])},[y(p(a(i)("article.cover"))+" ",1),r("div",Me,[w(r("input",{"onUpdate:modelValue":d[7]||(d[7]=t=>a(s).cover=t),type:"text",placeholder:a(i)("article.coverPlaceholder"),class:g({"form-error":f.value&&u.value.some(t=>t.field==="cover")})},null,10,Re),[[E,a(s).cover]]),r("div",Be,[r("button",{type:"button",class:"cover-upload-btn",onClick:d[8]||(d[8]=t=>v.value?.click())},p(a(i)("article.uploadImage")),1),r("input",{ref_key:"coverFileInput",ref:v,type:"file",accept:"image/*",style:{display:"none"},onChange:k},null,544),x.value?(S(),_("button",{key:0,type:"button",class:"cover-clear-btn",onClick:D},p(a(i)("article.clearImage")),1)):M("",!0)])]),x.value?(S(),_("div",Ne,[r("img",{src:x.value,alt:"Cover preview",onError:d[9]||(d[9]=t=>l.value=null)},null,40,Le)])):M("",!0)],2)])]),r("div",qe,[r("label",Je,[y(p(a(i)("article.coverPresets"))+" ",1),r("div",je,[(S(),_(R,null,B(A,(t,b)=>r("button",{key:b,type:"button",class:"cover-preset",style:ie({background:t}),onClick:U=>a(s).cover=t},null,12,ze)),64))])])]),r("div",Ye,[r("label",{class:g(["form-label",{"has-error":f.value&&u.value.some(t=>t.field==="content")}])},[y(p(a(i)("article.content"))+" ",1),w(r("textarea",{"onUpdate:modelValue":d[10]||(d[10]=t=>a(s).content=t),rows:"20",placeholder:a(i)("article.contentPlaceholder"),class:g(["content-textarea",{"form-error":f.value&&u.value.some(t=>t.field==="content")}])},null,10,Ge),[[E,a(s).content]])],2),r("p",Qe,p(a(i)("article.contentHint")),1)]),r("div",Xe,[r("button",{type:"button",class:"cancel-btn",onClick:X},p(a(i)("article.cancel")),1),r("button",{type:"submit",class:"submit-btn",disabled:a(V)||a($)},p(a($)?a(i)("article.saving"):a(V)?a(i)("article.saving"):I.value?a(i)("article.update"):a(i)("article.publish")),9,Ze)])],32)])]))}}),it=ue(et,[["__scopeId","data-v-afcad21f"]]);export{it as default};
