const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-WOWhqZIb.js","assets/vue-vendor-D_FnZyjM.js","assets/math-vendor-C4rbpj_m.js","assets/markdown-vendor-BDlm1NQN.js","assets/index-DCljqfLO.css"])))=>i.map(i=>d[i]);
import{aB as J}from"./math-vendor-C4rbpj_m.js";import{r as D,m as L,j as R,d as j,u as Y,e as x,p as z,q as G,s as Q,c as A,a as r,t as m,b as a,g as X,F as T,f as O,x as Z,n as p,h as v,w as y,v as k,y as ee,l as te,o as E}from"./vue-vendor-D_FnZyjM.js";import{c as ae,g as re}from"./index-WOWhqZIb.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./markdown-vendor-BDlm1NQN.js";const le="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let W=(o=21)=>{let i="",f=crypto.getRandomValues(new Uint8Array(o|=0));for(;o--;)i+=le[f[o]&63];return i};function B(o){const i=[];return o.title&&i.push(`title: ${P(o.title)}`),o.description&&i.push(`description: ${P(o.description)}`),o.categoryKey&&i.push(`categoryKey: ${P(o.categoryKey)}`),o.tag&&i.push(`tag: ${P(o.tag)}`),o.badge&&i.push(`badge: ${P(o.badge)}`),o.date&&i.push(`date: ${P(o.date)}`),o.platform&&i.push(`platform: ${P(o.platform)}`),o.cover&&i.push(`cover: ${P(o.cover)}`),(i.length>0?`---
${i.join(`
`)}
---

`:"")+(o.content||"").trim()}function P(o){return o.includes(":")||o.includes("#")||o.includes("|")||o.includes("&")||o.includes("*")||o.includes("!")||o.includes("%")||o.includes("@")||o.includes("`")||o.startsWith(" ")||o.endsWith(" ")||o.includes(`
`)?`"${o.replace(/"/g,'\\"')}"`:o}function N(o){const i=o.date||new Date().toISOString().split("T")[0],e=(o.title||"untitled").toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim();return`${i}-${e}`}const U=new Map;function $(o,i){try{const f=localStorage.getItem("article-file-handles")||"{}",e=JSON.parse(f);e[o]=i,localStorage.setItem("article-file-handles",JSON.stringify(e))}catch(f){console.error("Failed to save file handle:",f)}}function se(o){try{const i=localStorage.getItem("article-file-handles");if(i)return JSON.parse(i)[o]||null}catch(i){console.error("Failed to get file handle name:",i)}return null}const ie=()=>{const o=R(),i=D(!1),f=D(!1),e=L({title:"",description:"",content:"",categoryKey:"dit",tag:"",badge:"",date:new Date().toISOString().split("T")[0],platform:"Wechat",cover:"linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)"}),b=()=>{e.title="",e.description="",e.content="",e.categoryKey="dit",e.tag="",e.badge="",e.date=new Date().toISOString().split("T")[0],e.platform="Wechat",e.cover="linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)"},_=l=>ae.some(u=>u.id===l),s=l=>{e.id=l.id,e.title=l.title,e.description=l.description,e.content=l.content,e.categoryKey=l.categoryKey,e.tag=l.tag,e.badge=l.badge,e.date=l.date,e.platform=l.platform,e.cover=l.cover},F=()=>{const l=[];return e.title?.trim()||l.push({field:"title",message:"title"}),e.description?.trim()||l.push({field:"description",message:"description"}),e.content?.trim()||l.push({field:"content",message:"content"}),e.categoryKey||l.push({field:"category",message:"category"}),e.tag?.trim()||l.push({field:"tag",message:"tag"}),e.date||l.push({field:"date",message:"date"}),e.platform?.trim()||l.push({field:"platform",message:"platform"}),e.cover?.trim()||l.push({field:"cover",message:"cover"}),l},I=async()=>F().length>0?null:{id:e.id||W(),title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||"dit",tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],platform:e.platform||"Wechat",cover:e.cover||""};return{form:e,isSubmitting:i,isSavingFile:f,resetForm:b,loadArticle:s,validateForm:F,handleSubmit:I,handleSubmitAndRedirect:async()=>{const l=await I();l&&o.push({name:"articleDetail",params:{id:l.id}})},handlePublish:async()=>{if(F().length>0)return!1;if(!("showDirectoryPicker"in window))return alert("您的浏览器不支持文件系统访问 API，请使用 Chrome、Edge 或 Opera 浏览器"),!1;f.value=!0;try{const u={id:e.id||W(),title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||"dit",tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],platform:e.platform||"Wechat",cover:e.cover||""},n=B(u),c=N(u)+".md",h=await(await window.showDirectoryPicker()).getFileHandle(c,{create:!0}),S=await h.createWritable();return await S.write(n),await S.close(),u.id&&(U.set(u.id,h),$(u.id,c)),!0}catch(u){return u.name!=="AbortError"&&(console.error("Failed to save file:",u),alert("保存文件失败："+(u.message||"未知错误"))),!1}finally{f.value=!1}},handleUpdate:async()=>{if(F().length>0||!e.id)return!1;if(!("showSaveFilePicker"in window))return alert("您的浏览器不支持文件系统访问 API，请使用 Chrome、Edge 或 Opera 浏览器"),!1;f.value=!0;try{const u={id:e.id,title:e.title||"",description:e.description||"",content:e.content||"",categoryKey:e.categoryKey||"dit",tag:e.tag||"",badge:e.badge,date:e.date||new Date().toISOString().split("T")[0],platform:e.platform||"Wechat",cover:e.cover||""},n=B(u),c=N(u)+".md";let w=U.get(e.id);if(!w){const h=se(e.id);try{w=(await window.showOpenFilePicker({types:[{description:"Markdown files",accept:{"text/markdown":[".md"]}}],multiple:!1}))[0],U.set(e.id,w),h?$(e.id,h):$(e.id,c)}catch(S){if(S.name!=="AbortError")throw S;return!1}}if(w){const h=await w.createWritable();await h.write(n),await h.close()}else throw new Error("无法获取文件句柄");return!0}catch(u){return u.name!=="AbortError"&&(console.error("Failed to update file:",u),alert("更新文件失败："+(u.message||"未知错误"))),!1}finally{f.value=!1}},isArticleFromContent:_}},ne={class:"layout edit-layout"},ce={class:"hero"},de={class:"edit-content"},ue={key:0,class:"validation-errors"},fe={class:"error-header"},me={class:"error-title"},pe={class:"error-list"},ge={class:"form-section"},he=["placeholder"],ve={class:"form-section"},ye=["placeholder"],be={class:"form-row"},_e={class:"form-section"},we=["value"],Se={class:"form-section"},ke=["placeholder"],Pe={class:"form-row"},Fe={class:"form-section"},Ae={class:"form-section"},Ee=["placeholder"],Ie={class:"form-row"},Ke={class:"form-section"},De={class:"form-label"},Ve=["placeholder"],xe={class:"form-section"},Te=["placeholder"],Oe={class:"form-section"},Ue={class:"form-label"},$e={class:"cover-presets"},Ce=["onClick"],He={class:"form-section"},Me=["placeholder"],We={class:"form-hint"},Be={class:"form-actions"},Ne=["disabled"],Re=j({__name:"ArticleEditPage",setup(o){const i=z(),f=R(),{t:e}=Y(),b=x(()=>!!i.params.id),_=x(()=>{const g=i.params.id;return g||null}),{form:s,isSubmitting:F,isSavingFile:I,loadArticle:C,validateForm:V,resetForm:H,handlePublish:l,handleUpdate:u}=ie(),n=D([]),c=D(!1),w=x(()=>[{key:"dit",label:e("categories.dit")},{key:"luna",label:e("categories.luna")},{key:"note",label:e("categories.note")},{key:"art",label:e("categories.art")},{key:"travel",label:e("categories.travel")}]),h=["linear-gradient(135deg, #0a0f26 0%, #0c1a4d 35%, #032c5f 65%, #0c1a4d 100%)","linear-gradient(135deg, #0d121f 0%, #132642 50%, #243c5a 100%)","linear-gradient(135deg, #101820 0%, #1f1f2f 50%, #2c2c3b 100%)","linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)","linear-gradient(135deg, #2d1b69 0%, #11998e 100%)","linear-gradient(135deg, #667eea 0%, #764ba2 100%)"];G(()=>{if(b.value&&_.value){const g=re(_.value);g?C(g):f.push({name:"articles"})}else H()}),Q(()=>[s.title,s.description,s.content,s.categoryKey,s.tag,s.date,s.platform,s.cover],()=>{if(c.value&&n.value.length>0){const g=V();n.value=g,g.length===0&&(c.value=!1)}});const S=()=>{b.value&&_.value?f.push({name:"articleDetail",params:{id:_.value}}):f.push({name:"articles"})},q=async()=>{const g=V();if(g.length>0){n.value=g,c.value=!0,setTimeout(()=>{const d=document.querySelector(".form-error");d&&d.scrollIntoView({behavior:"smooth",block:"center"})},100);return}if(n.value=[],c.value=!1,b.value&&_.value){if(await u()){const{reloadArticles:t}=await J(async()=>{const{reloadArticles:K}=await import("./index-WOWhqZIb.js").then(M=>M.i);return{reloadArticles:K}},__vite__mapDeps([0,1,2,3,4]));await t(),f.push({name:"articleDetail",params:{id:_.value}})}}else await l()&&f.push({name:"articles"})};return(g,d)=>(E(),A("main",ne,[r("section",ce,[r("h1",null,m(b.value?a(e)("article.editTitle"):a(e)("article.createTitle")),1),r("p",null,m(b.value?a(e)("article.editDesc"):a(e)("article.createDesc")),1)]),r("section",de,[c.value&&n.value.length>0?(E(),A("div",ue,[r("div",fe,[d[9]||(d[9]=r("span",{class:"error-icon"},"⚠️",-1)),r("span",me,m(a(e)("article.validationError")),1)]),r("ul",pe,[(E(!0),A(T,null,O(n.value,(t,K)=>(E(),A("li",{key:K,class:"error-item"},m(a(e)(`article.${t.message}Required`)),1))),128))])])):X("",!0),r("form",{class:"article-form",onSubmit:Z(q,["prevent"])},[r("div",ge,[r("label",{class:p(["form-label",{"has-error":c.value&&n.value.some(t=>t.field==="title")}])},[v(m(a(e)("article.title"))+" ",1),y(r("input",{"onUpdate:modelValue":d[0]||(d[0]=t=>a(s).title=t),type:"text",placeholder:a(e)("article.titlePlaceholder"),class:p({"form-error":c.value&&n.value.some(t=>t.field==="title")})},null,10,he),[[k,a(s).title]])],2)]),r("div",ve,[r("label",{class:p(["form-label",{"has-error":c.value&&n.value.some(t=>t.field==="description")}])},[v(m(a(e)("article.description"))+" ",1),y(r("textarea",{"onUpdate:modelValue":d[1]||(d[1]=t=>a(s).description=t),rows:"3",placeholder:a(e)("article.descriptionPlaceholder"),class:p({"form-error":c.value&&n.value.some(t=>t.field==="description")})},null,10,ye),[[k,a(s).description]])],2)]),r("div",be,[r("div",_e,[r("label",{class:p(["form-label",{"has-error":c.value&&n.value.some(t=>t.field==="category")}])},[v(m(a(e)("article.category"))+" ",1),y(r("select",{"onUpdate:modelValue":d[2]||(d[2]=t=>a(s).categoryKey=t),class:p({"form-error":c.value&&n.value.some(t=>t.field==="category")})},[(E(!0),A(T,null,O(w.value,t=>(E(),A("option",{key:t.key,value:t.key},m(t.label),9,we))),128))],2),[[ee,a(s).categoryKey]])],2)]),r("div",Se,[r("label",{class:p(["form-label",{"has-error":c.value&&n.value.some(t=>t.field==="tag")}])},[v(m(a(e)("article.tag"))+" ",1),y(r("input",{"onUpdate:modelValue":d[3]||(d[3]=t=>a(s).tag=t),type:"text",placeholder:a(e)("article.tagPlaceholder"),class:p({"form-error":c.value&&n.value.some(t=>t.field==="tag")})},null,10,ke),[[k,a(s).tag]])],2)])]),r("div",Pe,[r("div",Fe,[r("label",{class:p(["form-label",{"has-error":c.value&&n.value.some(t=>t.field==="date")}])},[v(m(a(e)("article.date"))+" ",1),y(r("input",{"onUpdate:modelValue":d[4]||(d[4]=t=>a(s).date=t),type:"date",class:p({"form-error":c.value&&n.value.some(t=>t.field==="date")})},null,2),[[k,a(s).date]])],2)]),r("div",Ae,[r("label",{class:p(["form-label",{"has-error":c.value&&n.value.some(t=>t.field==="platform")}])},[v(m(a(e)("article.platform"))+" ",1),y(r("input",{"onUpdate:modelValue":d[5]||(d[5]=t=>a(s).platform=t),type:"text",placeholder:a(e)("article.platformPlaceholder"),class:p({"form-error":c.value&&n.value.some(t=>t.field==="platform")})},null,10,Ee),[[k,a(s).platform]])],2)])]),r("div",Ie,[r("div",Ke,[r("label",De,[v(m(a(e)("article.badge"))+" ",1),y(r("input",{"onUpdate:modelValue":d[6]||(d[6]=t=>a(s).badge=t),type:"text",placeholder:a(e)("article.badgePlaceholder")},null,8,Ve),[[k,a(s).badge]])])]),r("div",xe,[r("label",{class:p(["form-label",{"has-error":c.value&&n.value.some(t=>t.field==="cover")}])},[v(m(a(e)("article.cover"))+" ",1),y(r("input",{"onUpdate:modelValue":d[7]||(d[7]=t=>a(s).cover=t),type:"text",placeholder:a(e)("article.coverPlaceholder"),class:p({"form-error":c.value&&n.value.some(t=>t.field==="cover")})},null,10,Te),[[k,a(s).cover]])],2)])]),r("div",Oe,[r("label",Ue,[v(m(a(e)("article.coverPresets"))+" ",1),r("div",$e,[(E(),A(T,null,O(h,(t,K)=>r("button",{key:K,type:"button",class:"cover-preset",style:te({background:t}),onClick:M=>a(s).cover=t},null,12,Ce)),64))])])]),r("div",He,[r("label",{class:p(["form-label",{"has-error":c.value&&n.value.some(t=>t.field==="content")}])},[v(m(a(e)("article.content"))+" ",1),y(r("textarea",{"onUpdate:modelValue":d[8]||(d[8]=t=>a(s).content=t),rows:"20",placeholder:a(e)("article.contentPlaceholder"),class:p(["content-textarea",{"form-error":c.value&&n.value.some(t=>t.field==="content")}])},null,10,Me),[[k,a(s).content]])],2),r("p",We,m(a(e)("article.contentHint")),1)]),r("div",Be,[r("button",{type:"button",class:"cancel-btn",onClick:S},m(a(e)("article.cancel")),1),r("button",{type:"submit",class:"submit-btn",disabled:a(F)||a(I)},m(a(I)?a(e)("article.saving"):a(F)?a(e)("article.saving"):b.value?a(e)("article.update"):a(e)("article.publish")),9,Ne)])],32)])]))}}),ze=oe(Re,[["__scopeId","data-v-f85a0eb9"]]);export{ze as default};
