import{e as C,r as H,d as w,c as h,a as s,g as M,t as p,o as f,I as S,q as j,J as G,l as z,F as O,f as V,m as K,s as U,h as I,w as B,v as D,p as Q,C as E,b as F,j as W}from"./vue-vendor-BLy7Ta_u.js";import{_ as x,g as X,a as A}from"./_plugin-vue_export-helper-BkCLdZia.js";import{r as Y,g as L,a as Z,M as tt,i as et}from"./markdown-vendor-BDlm1NQN.js";import{H as q}from"./highlight-vendor-2JJYcUgK.js";import{b8 as N,b9 as nt}from"./math-vendor-C0ERF0R0.js";var ot=Y();const st=L(ot),_=n=>n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");var rt=Z();const at=L(rt),ct=n=>n.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-"),k=new tt({html:!0,linkify:!0,typographer:!0,breaks:!0,highlight:function(n,o){if(o==="flowchart"||o==="flow")return'<div class="flowchart-container"><pre class="flowchart" id="'+("flowchart-"+Math.random().toString(36).substr(2,9))+'">'+_(n)+"</pre></div>";if(o==="mermaid"||o==="sequenceDiagram"||o==="classDiagram"||o==="stateDiagram"||o==="erDiagram"||o==="journey"||o==="gantt"||o==="pie"||o==="requirement"||o==="gitgraph"||o==="mindmap"||o==="timeline")return'<div class="mermaid-container"><pre class="mermaid" id="'+("mermaid-"+Math.random().toString(36).substr(2,9))+'">'+_(n)+"</pre></div>";if(o&&q.getLanguage(o))try{return'<pre class="hljs"><code class="language-'+_(o)+'">'+q.highlight(n,{language:o}).value+"</code></pre>"}catch{}return'<pre class="hljs"><code>'+_(n)+"</code></pre>"}});k.use(et);k.use(st);k.use(at,{enabled:!0,label:!0,labelAfter:!0});const P=n=>{if(!n||!Array.isArray(n))return"";let o="";for(const r of n)r?.type==="text"&&r.content||r?.type==="code_inline"&&r.content?o+=r.content:r?.children&&(o+=P(r.children));return o};k.use(function(n){const o=n.renderer.rules.heading_open||function(r,i,l,u,t){return t.renderToken(r,i,l)};n.renderer.rules.heading_open=function(r,i,l,u,t){const e=r[i];if(!e)return o(r,i,l,u,t);const a=parseInt(e.tag.slice(1));let d="",c=i+1;for(;c<r.length&&r[c]?.type!=="heading_close";){const b=r[c];if(b?.type==="inline"){b.children?d=P(b.children):d=b.content||"";break}c++}const m=ct(d),g=u.headingCount||{},y=g[m]||0;g[m]=y+1;const $=y?`${m}-${y}`:m;return u.toc||(u.toc=[]),u.toc.push({id:$,text:d,level:a}),e.attrSet("id",$),o(r,i,l,u,t)}});const it=n=>{const o={toc:[],headingCount:{}};return{html:k.render(n,o),toc:o.toc||[]}},lt=n=>C(()=>it(n.value||"")),dt=(n="article-comments")=>{const o=H({}),r=()=>{try{const t=localStorage.getItem(n);o.value=t?JSON.parse(t):{}}catch{o.value={}}},i=()=>{localStorage.setItem(n,JSON.stringify(o.value))};return{commentsMap:o,loadComments:r,getComments:t=>o.value[t]??[],addComment:(t,e)=>{const a=e.content.trim();if(!a)return;const d=e.author?.trim()||"匿名",c=o.value[t]??[],m={id:Date.now(),author:d,content:a,createdAt:new Date().toISOString()};return o.value={...o.value,[t]:[...c,m]},i(),m}}},ut={class:"hero detail-hero"},mt={class:"header-actions"},ht={key:0,class:"title-area"},ft={key:0,class:"badge"},pt={class:"meta"},vt={key:1,class:"title-area"},gt=w({__name:"ArticleHeader",props:{article:{}},emits:["goBack","edit"],setup(n,{emit:o}){const r=o;return(i,l)=>(f(),h("section",ut,[s("div",mt,[s("button",{class:"back-btn",type:"button",onClick:l[0]||(l[0]=u=>r("goBack"))},"← 返回"),n.article?(f(),h("button",{key:0,class:"edit-btn",type:"button",onClick:l[1]||(l[1]=u=>r("edit"))},"✎ 编辑")):M("",!0)]),n.article?(f(),h("div",ht,[n.article.badge?(f(),h("span",ft,p(n.article.badge),1)):M("",!0),s("h1",null,p(n.article.title),1),s("p",pt,[s("span",null,p(n.article.date),1),l[2]||(l[2]=s("span",{class:"dot"},"·",-1)),s("span",null,p(n.article.platform),1),l[3]||(l[3]=s("span",{class:"dot"},"·",-1)),s("span",null,p(n.article.tag),1)])])):(f(),h("div",vt,[...l[4]||(l[4]=[s("h1",null,"未找到该文章",-1),s("p",{class:"meta"},"请返回列表重试",-1)])]))]))}}),yt=x(gt,[["__scopeId","data-v-21ab74c3"]]),Ct=n=>{const o=async(t,e)=>{try{await navigator.clipboard.writeText(t),r(e)}catch(a){console.error("复制失败:",a),i(t,e)}},r=t=>{const e=t.textContent;t.textContent="已复制!",t.classList.add("copied"),setTimeout(()=>{t.textContent=e,t.classList.remove("copied")},2e3)},i=(t,e)=>{const a=document.createElement("textarea");a.value=t,a.style.position="fixed",a.style.opacity="0",document.body.appendChild(a),a.select();try{document.execCommand("copy"),r(e)}catch(d){console.error("降级复制也失败:",d)}finally{document.body.removeChild(a)}},l=t=>{const e=document.createElement("button");return e.className="copy-code-btn",e.textContent="复制",e.type="button",e.setAttribute("aria-label","复制代码"),e.addEventListener("click",()=>{o(t,e)}),e};return{addCopyButtons:()=>{S(()=>{if(!n.value)return;n.value.querySelectorAll("pre.hljs").forEach(e=>{if(e.querySelector(".copy-code-btn"))return;const a=e.querySelector("code");if(!a)return;const d=a.textContent||a.innerText||"",c=l(d);e.appendChild(c)})})}}},bt=n=>{let o=!1;const r=()=>{o||(N.initialize({startOnLoad:!1,theme:"default",securityLevel:"loose"}),o=!0)},i=t=>{const e=t.id||"mermaid-"+Math.random().toString(36).substr(2,9),a=t.textContent||"";if(!a.trim())return;t.classList.add("mermaid-rendered");const d=e+"-svg";N.render(d,a).then(c=>{const m=t.parentElement;m&&m.classList.contains("mermaid-container")?m.innerHTML=c.svg:t.innerHTML=c.svg}).catch(c=>{console.error("Mermaid 渲染失败:",c),l(t,a)})},l=(t,e)=>{const a=t.parentElement;a&&a.classList.contains("mermaid-container")&&(a.innerHTML='<pre class="mermaid-error">'+_(e)+"</pre>")};return{initMermaid:()=>{S(()=>{if(!n.value)return;r(),n.value.querySelectorAll("pre.mermaid:not(.mermaid-rendered)").forEach(e=>{i(e)})})}}};var _t=nt();const wt=L(_t),xt=n=>{const o=()=>{const e=document.documentElement.classList.contains("dark");return{textColor:e?"#e0e0e0":"#000000",lineColor:e?"#e0e0e0":"#000000",fillColor:e?"#2a2a2a":"#ffffff",isDark:e}},r=()=>{const{textColor:e,lineColor:a,fillColor:d,isDark:c}=o();return{"line-width":2,"line-length":50,"text-margin":10,"font-size":14,"font-color":e,"line-color":a,"element-color":e,fill:d,"yes-text":"yes","no-text":"no","arrow-end":"block",scale:1,flowstate:{past:{fill:c?"#444444":"#CCCCCC","font-size":12},current:{fill:c?"#4a4a00":"yellow","font-color":c?"#ff6b6b":"red","font-weight":"bold"},future:{fill:c?"#666600":"#FFFF99"},request:{fill:c?"#003366":"blue"},invalid:{fill:c?"#222222":"#444444"},approved:{fill:"#58C4A3","font-size":12,"yes-text":"APPROVED","no-text":"n/a"},rejected:{fill:"#C45879","font-size":12,"yes-text":"n/a","no-text":"REJECTED"}}}},i=e=>{const a=document.createElement("div");return a.className="flowchart-svg-container",a.id=e+"-svg",a},l=e=>{const a=e.id||"flowchart-"+Math.random().toString(36).substr(2,9),d=e.textContent||"";if(d.trim()){e.classList.add("flowchart-rendered");try{const c=wt.parse(d),m=i(a),g=e.parentElement;if(g&&g.classList.contains("flowchart-container")){g.innerHTML="",g.appendChild(m);const y=r();c.drawSVG(a+"-svg",y)}}catch(c){console.error("Flowchart 渲染失败:",c),u(e,d)}}},u=(e,a)=>{const d=e.parentElement;d&&d.classList.contains("flowchart-container")&&(d.innerHTML='<pre class="flowchart-error">'+_(a)+"</pre>")};return{initFlowchart:()=>{S(()=>{if(!n.value)return;n.value.querySelectorAll("pre.flowchart:not(.flowchart-rendered)").forEach(a=>{l(a)})})}}},kt={class:"article-card detail-card"},$t={key:0,class:"badge"},Et={class:"card-body"},At={class:"tag-row"},Mt={class:"tag"},St={class:"title"},Lt={class:"description"},Tt={class:"meta"},It={class:"nav-row"},Bt=["disabled"],Dt=["disabled"],Ft=["innerHTML"],qt=w({__name:"ArticleContent",props:{article:{},htmlContent:{},prevArticle:{},nextArticle:{}},emits:["goPrev","goNext"],setup(n,{emit:o}){const r=n,i=o,l=H(),{addCopyButtons:u}=Ct(l),{initMermaid:t}=bt(l),{initFlowchart:e}=xt(l),a=()=>{u(),t(),e()};return j(()=>{a()}),G(()=>r.htmlContent,()=>{a()}),(d,c)=>(f(),h("article",kt,[s("div",{class:"card-cover",style:z({background:n.article.cover})},[n.article.badge?(f(),h("span",$t,p(n.article.badge),1)):M("",!0)],4),s("div",Et,[s("div",At,[s("span",Mt,p(n.article.tag),1)]),s("h2",St,p(n.article.title),1),s("p",Lt,p(n.article.description),1),s("div",Tt,[s("span",null,p(n.article.date),1),c[2]||(c[2]=s("span",{class:"dot"},"·",-1)),s("span",null,p(n.article.platform),1),c[3]||(c[3]=s("span",{class:"dot"},"·",-1)),s("span",null,p(n.article.tag),1)]),s("div",It,[s("button",{class:"ghost-btn",type:"button",disabled:!n.prevArticle,onClick:c[0]||(c[0]=m=>i("goPrev"))}," ← 上一篇 ",8,Bt),s("button",{class:"ghost-btn",type:"button",disabled:!n.nextArticle,onClick:c[1]||(c[1]=m=>i("goNext"))}," 下一篇 → ",8,Dt)]),s("div",{ref_key:"contentBlockRef",ref:l,class:"content-block",innerHTML:n.htmlContent},null,8,Ft)])]))}}),Nt=x(qt,[["__scopeId","data-v-f95392de"]]),Ht={key:0,class:"toc"},jt=["href"],zt=w({__name:"ArticleTOC",props:{toc:{}},setup(n){return(o,r)=>n.toc.length?(f(),h("aside",Ht,[r[0]||(r[0]=s("div",{class:"toc-title"},"目录",-1)),s("nav",null,[(f(!0),h(O,null,V(n.toc,i=>(f(),h("a",{key:i.id,class:"toc-item",style:z({paddingLeft:`${(i.level-1)*12}px`}),href:`#${i.id}`},p(i.text),13,jt))),128))])])):M("",!0)}}),Ot=x(zt,[["__scopeId","data-v-80897592"]]),Vt={class:"comments"},Pt={class:"comments__header"},Jt={class:"comments__count"},Rt={key:0,class:"comments__list"},Gt={class:"comment__header"},Kt={class:"comment__author"},Ut={class:"comment__time"},Qt={class:"comment__content"},Wt={key:1,class:"comments__empty"},Xt={class:"form-row"},Yt={class:"form-row"},Zt=w({__name:"CommentSection",props:{comments:{},articleId:{}},emits:["submit"],setup(n,{emit:o}){const r=o,i=K({author:"",content:""}),l=()=>{const u=i.content.trim();u&&(r("submit",{author:i.author,content:u}),i.author="",i.content="")};return(u,t)=>(f(),h("section",Vt,[s("header",Pt,[t[2]||(t[2]=s("h3",null,"评论",-1)),s("span",Jt,p(n.comments.length)+" 条",1)]),n.comments.length?(f(),h("ul",Rt,[(f(!0),h(O,null,V(n.comments,e=>(f(),h("li",{key:e.id,class:"comment"},[s("div",Gt,[s("span",Kt,p(e.author),1),s("span",Ut,p(new Date(e.createdAt).toLocaleString()),1)]),s("p",Qt,p(e.content),1)]))),128))])):(f(),h("p",Wt,"暂无评论，快来写第一条吧。")),s("form",{class:"comment-form",onSubmit:U(l,["prevent"])},[s("div",Xt,[s("label",null,[t[3]||(t[3]=I(" 昵称（可选） ",-1)),B(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.author=e),placeholder:"你的昵称"},null,512),[[D,i.author]])])]),s("div",Yt,[s("label",null,[t[4]||(t[4]=I(" 评论内容 ",-1)),B(s("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.content=e),rows:"4",required:"",placeholder:"写下你的想法..."},null,512),[[D,i.content]])])]),t[5]||(t[5]=s("button",{class:"submit-btn",type:"submit"},"发布评论",-1))],32)]))}}),te=x(Zt,[["__scopeId","data-v-b2135773"]]),ee={class:"layout detail-layout"},ne={class:"article-area"},oe={key:0,class:"detail-grid"},se={class:"content-wrapper"},re={key:1,class:"article-card detail-card empty-state"},ae=w({__name:"ArticleDetailPage",setup(n){const o=Q(),r=W(),{loadComments:i,getComments:l,addComment:u}=dt(),t=C(()=>{const v=Number(o.params.id);return Number.isFinite(v)?X(v)??null:null}),e=C(()=>t.value?.content??""),a=lt(e),d=C(()=>t.value?A.findIndex(v=>v.id===t.value?.id):-1),c=C(()=>d.value>0?A[d.value-1]:null),m=C(()=>d.value>=0&&d.value<A.length-1?A[d.value+1]:null),g=C(()=>{const v=t.value?.id;return v?l(v):[]}),y=()=>{r.back()},$=()=>{c.value&&r.push({name:"articleDetail",params:{id:c.value.id}})},b=()=>{m.value&&r.push({name:"articleDetail",params:{id:m.value.id}})},J=()=>{t.value&&r.push({name:"articleEdit",params:{id:t.value.id}})},R=v=>{t.value&&u(t.value.id,v)};return j(()=>{i()}),(v,T)=>(f(),h("main",ee,[E(yt,{article:t.value,onGoBack:y,onEdit:J},null,8,["article"]),s("section",ne,[t.value?(f(),h("div",oe,[s("div",se,[E(Nt,{article:t.value,"html-content":F(a).html,"prev-article":c.value??null,"next-article":m.value??null,onGoPrev:$,onGoNext:b},null,8,["article","html-content","prev-article","next-article"]),E(te,{comments:g.value,"article-id":t.value.id,onSubmit:R},null,8,["comments","article-id"])]),E(Ot,{toc:F(a).toc},null,8,["toc"])])):(f(),h("article",re,[...T[0]||(T[0]=[s("div",{class:"card-body"},[s("h2",{class:"title"},"未找到该文章"),s("p",{class:"description"},"请返回列表重试")],-1)])]))])]))}}),me=x(ae,[["__scopeId","data-v-ef4f9aa0"]]);export{me as default};
